' 
' +==== BEGIN CatFeeder =================+
' LOGO: 
' ..............(..../\
' ...............)..(.')
' ..............(../..)
' ...............\(__)|
' Inspired by Joan Stark
' source https://www.asciiart.eu/
' animals/cats
' /STOP
' PROJECT: CatFeeder
' FILE: core_shutdown.puml
' CREATION DATE: 02-12-2025
' LAST Modified: 15:25:12 02-12-2025
' DESCRIPTION: 
' This is the project in charge of making the connected cat feeder project work.
' /STOP
' COPYRIGHT: (c) Cat Feeder
' PURPOSE: The shutdown overview of the server class from the core module.
' // AR
' +==== END CatFeeder =================+
' 
@startuml core_shutdown
!theme plain

participant "Server" as Server
participant "RuntimeControl" as RC
participant "RuntimeManager" as RM
collections "Services" as Services

Server -> RC: signal_shutdown()
activate RC
RC -> RC: set _shutdown_event
note right: Global shutdown signal
RC --> Server: acknowledged
deactivate RC

Server -> RM: get_all_instances()
activate RM
RM --> Server: [service1, service2, ...]
deactivate RM

loop for each service
    Server -> Services: shutdown()
    activate Services
    Services -> Services: cleanup resources
    note right
        - Close connections
        - Flush caches
        - Stop background tasks
    end note
    Services --> Server: completed
    deactivate Services
end

Server -> Server: exit gracefully

note over Server, Services
    Services can check RuntimeControl.is_shutting_down()
    during execution to stop early
end note

@enduml
